## Canopy: 端到端性能跟踪分析系统

### 1.针对的问题
用户执行各种各样的操作（例如在Facebook.com上加载一个页面），并通过异构客户端（包括Web浏览器和移动应用程序）、网络和分布式后端服务的复杂执行，从而
获取不同级别的信息和对应用程序的控制。  
动态因素还会影响性能，例如持续部署新代码，更改配置，工程师需要随时访问性能数据，理想地根据他们想要解决的问题和他们通常要求的问题进行调整
孤立的追踪方法每个系统专门针对特定用例，难以扩展到其他域。在每种情况下，对跟踪的分析仅限于固定工作流程，每个域功能的定制有限，每个系统支持的分析类型
也是相当僵化的，
新功能或分析的迭代时间慢，变化需要几天才能部署。
工程师需要了解多个跟踪工具以及何时使用和切换它们。

### 2.主要思想
将端到端执行路径的性能数据与结构化和因果相关的执行跟踪相结合，以实现定制性能分析
通过系统传播标识符来构建跟踪，以便跨组件关联信息。 
使用跟踪来解决性能问题。
首先，端到端的性能数据是异构的，具有多个执行模型，并且在可用于分析的数据的粒度和质量方面有广泛的变化。
快速解决性能问题需要能够有效地切片，分组，过滤，聚合和总结基于任意特征的跟踪的工具。
跟踪包含任何工程师识别问题所需的所有数据。
端：异构客户端（浏览器，移动应用程序）
端：服务端（facebook）分布式后端服务
输入：用户指定的功能
特点：聚合了数十亿个请求的性能数据集
实时查询和分析性能数据
支持Facebook堆栈不同组件使用的执行和性能模型的范围;
支持性能数据的交互式特点分析;
从采样轨迹到提取和可视化功能用户可以深入定制。

### 3.原理
在开发阶段，Facebook工程师可以使用针对不同执行模式量身定制的一系列API来调整系统。 在运行时，Canopy将生成的性能数据映射到灵活的基于事件的表示。 
Canopy的后端管道在近距离接收事件; 重构分析查询更加便利的高级跟踪模型; 从痕迹中提取用户指定的特征; 并将结果输出到用于自定义聚合可视化的数据集
4.本文作出以下贡献：
●用于跟踪的解耦设计将仪器与跟踪模型分离开，实现独立演进和不同执行模型的组合。
●完整的管道，将轨迹转换为自定义的一组提取的特征，以实现快速分析。
●一组可定制的跟踪组件，用于为不同的用例提供相同数据的多个视图。

2.1实例说明跨系统组件相关的一系列不同信息对于诊断问题是必要的

然而，很难预测有用的信息或工程师在分析中采取的步骤。 在Facebook的实践中，成功的诊断性能问题的方法通常基于人类的直觉

Canopy的目标是允许人类生成的假设被快速测试和证明或反驳，从而实现快速迭代。

